function module(e,n,t){var i,r,o,a,l,c,s,u,m,f,d,p,h,k,x,E,v,b,g,C,T,R,_,w,P,I,S,L,y,G,z,M,N;function V(){var e=i(["white-space: nowrap"]);return V=function(){return e},e}t.link("@babel/runtime/helpers/taggedTemplateLiteralLoose",{default:function(e){i=e}},0),t.link("@babel/runtime/helpers/extends",{default:function(e){r=e}},1),t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){o=e}},2),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){a=e}},3),t.link("@babel/runtime/regenerator",{default:function(e){l=e}},4),t.link("react",{default:function(e){c=e},useState:function(e){s=e},useCallback:function(e){u=e},useEffect:function(e){m=e}},0),t.link("@rocket.chat/fuselage",{TextInput:function(e){f=e},Table:function(e){d=e},Margins:function(e){p=e},Box:function(e){h=e},Icon:function(e){k=e},CheckBox:function(e){x=e},Throbber:function(e){E=e},Tabs:function(e){v=e},Button:function(e){b=e}},1),t.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){g=e},useDebouncedValue:function(e){C=e}},2),t.link("@rocket.chat/css-in-js",{css:function(e){T=e}},3),t.link("../../../components/Page",{default:function(e){R=e}},4),t.link("./PermissionsContextBar",{default:function(e){_=e}},5),t.link("../../../components/GenericTable",{default:function(e){w=e}},6),t.link("../../../hooks/useReactiveValue",{useReactiveValue:function(e){P=e}},7),t.link("../../../contexts/TranslationContext",{useTranslation:function(e){I=e}},8),t.link("../../../contexts/ServerContext",{useMethod:function(e){S=e}},9),t.link("../../../contexts/ToastMessagesContext",{useToastMessageDispatch:function(e){L=e}},10),t.link("../../../contexts/RouterContext",{useRoute:function(e){y=e}},11),t.link("../../../../app/authorization/client/lib/ChatPermissions",{ChatPermissions:function(e){G=e}},12),t.link("../../../../app/authorization/lib",{CONSTANTS:function(e){z=e},AuthorizationUtils:function(e){M=e}},13),t.link("../../../../app/models/client",{Roles:function(e){N=e}},14);var H=function(e){var n=e.onGrant,t=e.onRemove,i=e.permissionId,r=L();return g(function(){function e(e,o){return l.async(function(){function a(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!o){a.next=6;break}return a.next=4,l.awrap(t(i,e));case 4:a.next=8;break;case 6:return a.next=8,l.awrap(n(i,e));case 8:return a.abrupt("return",!o);case 11:a.prev=11,a.t0=a.catch(0),r({type:"error",message:a.t0});case 14:return a.abrupt("return",o);case 15:case"end":return a.stop()}}return a}(),null,null,[[0,11]],Promise)}return e}())},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"permissions",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=u((function(){var r=new RegExp(n,"i");return G.find({level:"permissions"===e?{$ne:z.SETTINGS_LEVEL}:z.SETTINGS_LEVEL,_id:r},{sort:{_id:1},skip:i,limit:t})}),[n,t,i,e]),o=g((function(){return N.find().fetch()}),[]),a=P(r),l=P(o);return[a.fetch(),a.count(!1),l]},D=c.memo((function(e){var n=e.grantedRoles,t=void 0===n?[]:n,i=e._id,r=e.description,o=e.onChange,u=e.lineHovered,m=e.permissionId,f=s((function(){return!!t.includes(i)})),k=a(f,2),v=k[0],b=k[1],C=s(!1),T=a(C,2),R=T[0],_=T[1],w=M.isPermissionRestrictedForRole(m,i),P=g(function(){function e(){var e;return l.async(function(){function n(n){for(;;)switch(n.prev=n.next){case 0:return _(!0),n.next=3,l.awrap(o(i,v));case 3:e=n.sent,b(e),_(!1);case 6:case"end":return n.stop()}}return n}(),null,null,null,Promise)}return e}()),I=!!R||!!w;return c.createElement(d.Cell,{withTruncatedText:!0},c.createElement(p,{inline:"x2"},c.createElement(x,{checked:v,onChange:P,disabled:I}),!R&&c.createElement(h,{display:"inline",color:"hint",invisible:!u},r||i),R&&c.createElement(E,{size:"x12",display:"inline-block"})))})),A=function(e,n){if(n.level===z.SETTINGS_LEVEL){var t="";return n.group&&(t=e(n.group)+" > "),n.section&&(t=""+t+e(n.section)+" > "),""+t+e(n.settingId)}return e(n._id)},F=c.memo((function(e){var n=e.permission,t=e.t,i=e.roleList,l=e.onGrant,u=e.onRemove,m=o(e,["permission","t","roleList","onGrant","onRemove"]),f=n._id,p=n.roles,h=s(!1),k=a(h,2),x=k[0],E=k[1],v=g((function(){return E(!0)})),b=g((function(){return E(!1)})),C=H({onGrant:l,onRemove:u,permissionId:f});return c.createElement(d.Row,r({key:f,role:"link",action:!0,tabIndex:0,onMouseEnter:v,onMouseLeave:b},m),c.createElement(d.Cell,{maxWidth:"x300",withTruncatedText:!0,title:t(f+"_description")},A(t,n)),i.map((function(e){var n=e._id,t=e.description;return(c.createElement(D,{key:n,_id:n,description:t,grantedRoles:p,onChange:C,lineHovered:x,permissionId:n}))})))})),W=c.memo((function(e){var n=e.router,t=e._id,i=e.description,a=o(e,["router","_id","description"]),l=g((function(){n.push({context:"edit",_id:t})}));return c.createElement(w.HeaderCell,r({clickable:!0,pi:"x4",p:"x8"},a),c.createElement(h,{className:T(V()),pb:"x8",pi:"x12",mi:"neg-x2",borderStyle:"solid",borderWidth:"x2",borderRadius:"x2",borderColor:"neutral-300",onClick:l},c.createElement(p,{inline:"x2"},c.createElement("span",null,i||t),c.createElement(k,{name:"edit",size:"x16"}))))})),j=function(e){var n=e.onChange,t=I(),i=s(""),r=a(i,2),o=r[0],l=r[1],u=C(o,500);m((function(){n(u)}),[u,n]);var d=g((function(e){var n=e.currentTarget.value;l(n)}));return(c.createElement(f,{value:o,onChange:d,placeholder:t("Search"),flexGrow:0}))},q=function(){var e=I(),n=s(""),t=a(n,2),i=t[0],r=t[1],o=s("permissions"),l=a(o,2),m=l[0],f=l[1],d=s({limit:25,skip:0}),h=a(d,2),x=h[0],E=h[1],C=y("admin-permissions"),T=S("authorization:addPermissionToRole"),P=S("authorization:removeRoleFromPermission"),L=B(m,i,x.limit,x.skip),G=a(L,3),z=G[0],M=G[1],N=G[2],V=g((function(e){var n=e.current,t=e.itemsPerPage;E({skip:n,limit:t})})),H=g((function(){"permissions"!==m&&f("permissions")})),D=g((function(){"settings"!==m&&f("settings")})),A=g((function(){C.push({context:"new"})}));return c.createElement(R,{flexDirection:"row"},c.createElement(R,null,c.createElement(R.Header,{title:e("Permissions")},c.createElement(b,{small:!0,square:!0,onClick:A},c.createElement(k,{name:"plus"}))),c.createElement(p,{blockEnd:"x8"},c.createElement(v,null,c.createElement(v.Item,{selected:"permissions"===m,onClick:H},e("Permissions")),c.createElement(v.Item,{selected:"settings"===m,onClick:D},e("Settings")))),c.createElement(R.Content,{mb:"neg-x8"},c.createElement(p,{block:"x8"},c.createElement(j,{onChange:r}),c.createElement(w,{header:c.createElement(c.Fragment,null,c.createElement(w.HeaderCell,{width:"x120"},e("Name")),N.map((function(e){var n=e._id,t=e.description;return(c.createElement(W,{key:n,_id:n,description:t,router:C}))}))),total:M,results:z,params:x,setParams:V,fixed:!1},u((function(n){return c.createElement(F,{key:n._id,permission:n,t:e,roleList:N,onGrant:T,onRemove:P})}),[T,P,N,e]))))),c.createElement(_,null))};t.exportDefault(q)}

