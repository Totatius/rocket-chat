function module(e,t,n){let r,l,a,o,s,i,u,d,c,m,p,h,k,f,g,x,C,E,b,T,y,w,I,S,M,R,U,v,L,B,D,G,_,z,A,N,P,F,j,H,W,O,V;function Q(e){return t=>{let{msg:n,username:o,replies:s=[],tcount:i,ts:u}=t,d=l(t,["msg","username","replies","tcount","ts"]);return(a.createElement(e,r({replies:i,participants:null==s?void 0:s.length,username:o,msg:n,ts:u},d)))}}n.link("@babel/runtime/helpers/extends",{default(e){r=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){l=e}},1),n.export({withData:()=>Y,normalizeThreadMessage:()=>$,ThreadList:()=>te}),n.link("react",{default(e){a=e},useCallback(e){o=e},useMemo(e){s=e},useState(e){i=e},useRef(e){u=e},memo(e){d=e}},0),n.link("@rocket.chat/fuselage",{Box(e){c=e},Icon(e){m=e},TextInput(e){p=e},Select(e){h=e},Margins(e){k=e},Callout(e){f=e}},1),n.link("react-window",{FixedSizeList(e){g=e}},2),n.link("react-window-infinite-loader",{default(e){x=e}},3),n.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){C=e},useResizeObserver(e){E=e},useLocalStorage(e){b=e},useMutableCallback(e){T=e}},4),n.link("../../../../components/VerticalBar",{default(e){y=e}},5),n.link("../../../../contexts/TranslationContext",{useTranslation(e){w=e}},6),n.link("../../../../contexts/RouterContext",{useRoute(e){I=e},useCurrentRoute(e){S=e},useQueryStringParameter(e){M=e}},7),n.link("../../../../../app/ui-utils/client",{call(e){R=e}},8),n.link("../../../../contexts/UserContext",{useUserId(e){U=e},useUserSubscription(e){v=e}},9),n.link("../../hooks/useUserRoom",{useUserRoom(e){L=e}},10),n.link("../../../../contexts/SettingsContext",{useSetting(e){B=e}},11),n.link("../../../../hooks/useTimeAgo",{useTimeAgo(e){D=e}},12),n.link("../../../../lib/clickableItem",{clickableItem(e){G=e}},13),n.link("../../components/Message",{MessageSkeleton(e){_=e}},14),n.link("./components/Message",{default(e){z=e}},15),n.link("../../../../../lib/escapeHTML",{escapeHTML(e){A=e}},16),n.link("../../../../hooks/useAsyncState",{AsyncStatePhase(e){N=e}},17),n.link("../../../../components/ScrollableContentWrapper",{default(e){P=e}},18),n.link("../../providers/ToolboxProvider",{useTabBarClose(e){F=e},useTabContext(e){j=e}},19),n.link("../../../../../app/threads/client/components/ThreadComponent",{default(e){H=e}},20),n.link("../../../../lib/renderMessageBody",{renderMessageBody(e){W=e}},21),n.link("./useThreadsList",{useThreadsList(e){O=e}},22),n.link("../../../../hooks/lists/useRecordList",{useRecordList(e){V=e}},23);const q=a.memo(Q(G(z))),J=a.memo(G(_)),K={tunread:1,tunreadUser:1,tunreadGroup:1},X={t:1,name:1};function Y(e){return t=>{let{rid:n}=t,u=l(t,["rid"]);const d=U(),c=F(),m=L(n,X),p=v(n,K),[h,k]=b("thread-list-type","all"),[f,g]=i(""),x=C(f,400),E=s(()=>({rid:n,text:x,type:h,tunread:null==p?void 0:p.tunread,uid:d}),[n,x,h,p,d]),{threadsList:T,initialItemCount:y,loadMoreItems:w}=O(E,d),{phase:I,error:S,items:M,itemCount:R}=V(T),B=o(e=>{g(e.currentTarget.value)},[]);return a.createElement(e,r({},u,{unread:null==p?void 0:p.tunread,unreadUser:null==p?void 0:p.tunreadUser,unreadGroup:null==p?void 0:p.tunreadGroup,userId:d,error:S,threads:M,total:R,initial:y,loading:I===N.LOADING,loadMoreItems:w,room:m,text:f,setText:B,type:h,setType:k,onClose:c}))}}const Z=e=>{e.preventDefault(),e.stopPropagation(),R([!0,"true"].includes(e.currentTarget.dataset.following)?"unfollowMessage":"followMessage",{mid:e.currentTarget.dataset.id})},$=e=>{let t=r({},e);if(t.msg)return W(t).replace(/<br\s?\\?>/g," ");if(t.attachments){const e=t.attachments.find(e=>e.title||e.description);if(e&&e.description)return A(e.description);if(e&&e.title)return A(e.title)}},ee=d((function e(t){let{data:n,index:l,style:o,showRealNames:s,unread:i,unreadUser:u,unreadGroup:d,userId:c,onClick:m}=t;const p=w(),h=D();if(!n[l])return a.createElement(J,{style:o});const k=n[l],f=$(k),{name:g=k.u.username}=k.u;return a.createElement(q,r({},k,{name:s?g:k.u.username,username:k.u.username,style:o,unread:i.includes(k._id),mention:u.includes(k._id),all:d.includes(k._id),following:k.replies&&k.replies.includes(c),"data-id":k._id,msg:f,t:p,formatDate:h,handleFollowButton:Z,onClick:m}))}));function te(e){let{total:t=10,initial:n=10,threads:r=[],room:l,unread:i=[],unreadUser:d=[],unreadGroup:C=[],type:b,setType:R,loadMoreItems:U,loading:v,onClose:L,error:D,userId:G,text:_,setText:z}=e;const A=B("UI_Use_Real_Name"),N=u(),F=w(),[W]=S(),O=I(W),V=T(e=>{const{id:t}=e.currentTarget.dataset;O.push({tab:"thread",context:t,rid:l._id,name:l.name})}),Q=s(()=>[["all",F("All")],["following",F("Following")],["unread",F("Unread")]],[F]);N.current=r;const q=o(e=>{let{data:t,index:n,style:r}=e;return(a.createElement(ee,{data:t,index:n,style:r,showRealNames:A,unread:i,unreadUser:d,unreadGroup:C,userId:G,onClick:V}))},[A,i,d,C,G,V]),J=T(e=>e<N.current.length),{ref:K,contentBoxSize:{inlineSize:X=378,blockSize:Y=1}={}}=E({debounceDelay:200}),Z=j(),$=M("jump");return a.createElement(a.Fragment,null,a.createElement(y.Header,null,a.createElement(y.Icon,{name:"thread"}),a.createElement(y.Text,null,F("Threads")),a.createElement(y.Close,{onClick:L})),a.createElement(y.Content,{paddingInline:0},a.createElement(c,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200",flexShrink:0},a.createElement(c,{display:"flex",flexDirection:"row",flexGrow:1,mi:"neg-x4"},a.createElement(k,{inline:"x4"},a.createElement(p,{placeholder:F("Search_Messages"),value:_,onChange:z,addon:a.createElement(m,{name:"magnifier",size:"x20"})}),a.createElement(h,{flexGrow:0,width:"110px",onChange:R,value:b,options:Q})))),a.createElement(c,{flexGrow:1,flexShrink:1,ref:K,overflow:"hidden",display:"flex"},D&&a.createElement(f,{mi:"x24",type:"danger"},D.toString()),0===t&&a.createElement(c,{p:"x24"},F("No_Threads")),!D&&t>0&&a.createElement(x,{isItemLoaded:J,itemCount:t,loadMoreItems:v?()=>{}:U},e=>{let{onItemsRendered:l,ref:o}=e;return(a.createElement(g,{outerElementType:P,height:Y,width:X,itemCount:t,itemData:r,itemSize:124,ref:o,minimumBatchSize:n,onItemsRendered:l},q))}))),Z&&a.createElement(y.InnerContent,null,a.createElement(H,{mid:Z,jump:$,room:l})))}n.exportDefault(Y(te))}

